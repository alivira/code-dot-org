#!/usr/bin/env ruby

# This script assigns default workshops to teacher applications
# including fit workshops for facilitators, only when none is already assigned.
# This is idempotent and safe to run multiple times

require 'csv'
require_relative '../../dashboard/config/environment'

def update_teacher_application_workshops
  puts "Updating teacher application workshops..."

  counts = {
    skipped: 0,
    updated: 0,
    no_workshop: 0
  }
  Pd::Application::TeacherApplication.find_each do |teacher_application|
    if teacher_application.pd_workshop_id
      counts[:skipped] += 1
    else
      teacher_application.assign_default_workshop!
      if teacher_application.pd_workshop_id
        counts[:updated] += 1
      else
        counts[:no_workshop] += 1
      end
    end
  end

  puts counts.inspect
end

update_teacher_application_workshops
